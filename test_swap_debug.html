<!DOCTYPE html>
<html>
<head>
    <title>Test Swap Debug</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .test-button { padding: 10px; margin: 5px; cursor: pointer; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Test Swap Debug</h1>
    
    <button class="test-button" onclick="testSwap()">Test Swap Function</button>
    <button class="test-button" onclick="testCondition()">Test Condition</button>
    
    <div id="log" class="log"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += msg + '<br>';
        }
        
        // Simulate the swap function
        function handleSeatSwap(studentA, tableA, seatA, studentB, tableB, seatB) {
            log('handleSeatSwap called:');
            log(`  Student A: ${studentA}, Table ${tableA}, Seat ${seatA}`);
            log(`  Student B: ${studentB}, Table ${tableB}, Seat ${seatB}`);
            
            const prev = {
                1: { '1': 101, '2': 102 },
                2: { '1': 201, '2': 202 }
            };
            
            log('Previous: ' + JSON.stringify(prev));
            
            const newAssignments = { ...prev };
            
            // Remove both students
            if (newAssignments[tableA]) {
                delete newAssignments[tableA][seatA];
                if (Object.keys(newAssignments[tableA]).length === 0) {
                    delete newAssignments[tableA];
                }
            }
            if (newAssignments[tableB]) {
                delete newAssignments[tableB][seatB];
                if (Object.keys(newAssignments[tableB]).length === 0) {
                    delete newAssignments[tableB];
                }
            }
            
            log('After removal: ' + JSON.stringify(newAssignments));
            
            // Swap
            const result = {
                ...newAssignments,
                [tableA]: {
                    ...newAssignments[tableA],
                    [seatA]: studentB,
                },
                [tableB]: {
                    ...newAssignments[tableB],
                    [seatB]: studentA,
                },
            };
            
            log('Final result: ' + JSON.stringify(result));
            log('---');
        }
        
        function testSwap() {
            log('Testing swap:');
            handleSeatSwap(101, 1, '1', 202, 2, '2');
        }
        
        function testCondition() {
            const sourceType = "seat";
            const assignedStudent = { id: 123, name: "Test" };
            
            log('Testing conditions:');
            log(`sourceType: "${sourceType}" (type: ${typeof sourceType})`);
            log(`assignedStudent: ${JSON.stringify(assignedStudent)}`);
            log(`sourceType === "seat": ${sourceType === "seat"}`);
            log(`!!assignedStudent: ${!!assignedStudent}`);
            log(`sourceType === "seat" && assignedStudent: ${sourceType === "seat" && assignedStudent}`);
            log('---');
        }
    </script>
</body>
</html>